<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.devsurfer.purepicks.manager.mapper.FileMapper">

    <sql id="file_column">
        `file_id`,`original_filename`,`final_filename`,`file_size`,`file_type`, `file_path`,`file_extension`,`upload_time`,
        `upload_uid`,`file_url`,`file_status`,`checksum`
    </sql>

    <insert id="insertFile">
        insert into `file_info`
        (`original_filename`, `final_filename`, `file_size`, `file_type`, `file_path`,  `file_extension`,
         `upload_uid`, `file_url`, `checksum`)
        values (#{originalFilename}, #{finalFilename}, #{fileSize}, #{fileType}, #{filePath}, #{fileExtension},
                #{uploadUid}, #{fileUrl}, #{checksum})
    </insert>

    <select id="selectByFileId" resultType="com.devsurfer.purepicks.model.entity.file.FileInfo">
        select <include refid="file_column"/>
        from `file_info` where `file_id` = #{fileId}
    </select>

    <select id="findFileList" resultType="com.devsurfer.purepicks.model.vo.system.file.FileInfoVo">
        select <include refid="file_column"/>
        from `file_info`
        <where>
            <if test="keyword != null and keyword != ''">
                and (
                `original_filename` like concat("%", #{keyword}, "%") or
                `final_filename` like concat("%", #{keyword}, "%") or
                `file_extension` like concat("%", #{keyword}, "%")
                )
            </if>
            <if test="fileTypeList != null and fileTypeList.size() > 0">
                and `file_type` in
                <foreach collection="fileTypeList" item="fileType" open="(" close=")" separator=",">
                    #{fileType}
                </foreach>
            </if>
            <if test="uploadUidList != null and uploadUidList.size() > 0">
                and `upload_uid` in
                <foreach collection="uploadUidList" item="uploadUid" open="(" close=")" separator=",">
                    #{uploadUid}
                </foreach>
            </if>
            <if test="fileStatusList != null and fileStatusList.size() > 0">
                and `file_status` in
                <foreach collection="fileStatusList" item="fileStatus" open="(" close=")" separator=",">
                    #{fileStatus}
                </foreach>
            </if>
            <if test="uploadStartTime != null and uploadEndTime != null and uploadStartTime != '' and uploadEndTime != ''">
                and `upload_time` between #{uploadStartTime} and #{uploadEndTime}
            </if>
        </where>
    </select>

    <update id="updateFileStatus">
        update `file_info` set `file_status` = #{status} where `file_id` = #{fileId}
    </update>
</mapper>
