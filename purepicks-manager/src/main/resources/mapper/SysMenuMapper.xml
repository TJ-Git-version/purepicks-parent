<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.devsurfer.purepicks.manager.mapper.SysMenuMapper">
    <sql id="menu_column">
        `id`, `parent_id`, `title`, `menu_code`, `sort`, `status`, `has_children`
    </sql>

    <select id="selectOne" resultType="com.devsurfer.purepicks.model.entity.system.SysMenu">
        select
        <include refid="menu_column"/>
        from `sys_menu`
        <where>
            `is_deleted` = 1
            <if test="id != null">
                and `id` = #{id}
            </if>
            <if test="notId != null">
                and `id` != #{notId}
            </if>
            <if test="parentId != null">
                and `parent_id` = #{parentId}
            </if>
            <if test="title != null and title != ''">
                and `title` = #{title}
            </if>
            <if test="menuCode != null and menuCode != ''">
                and `menu_code` = #{menuCode}
            </if>
            <if test="status != null">
                and `status` = #{status}
            </if>
        </where>
    </select>

    <insert id="insertMenu">
        insert into `sys_menu` (`parent_id`, `title`, `menu_code`, `sort`, `status`)
        values (#{parentId}, #{title}, #{menuCode}, #{sort}, #{status})
    </insert>

    <update id="updateMenu">
        update `sys_menu`
        <set>
            <if test="parentId != null">
                `parent_id` = #{parentId},
            </if>
            <if test="title != null and title != ''">
                `title` = #{title},
            </if>
            <if test="menuCode != null and menuCode != ''">
                `menu_code` = #{menuCode},
            </if>
            <if test="sort != null">
                `sort` = #{sort},
            </if>
            <if test="status != null">
                `status` = #{status},
            </if>
        </set>
        where `id` = #{id} and `is_deleted` = 1
    </update>

    <delete id="removeMenu">
        update `sys_menu`
        set `is_deleted` = 0
        where `id` = #{menuId} and `is_deleted` = 1
    </delete>

    <update id="updateHasChildrenByParentId">
        update `sys_menu`
        set `has_children` = 1
        where id = #{parentId} and `has_children` = 0 and `is_deleted` = 1
    </update>

    <select id="findMenuList" resultType="com.devsurfer.purepicks.model.entity.system.SysMenu">
        select <include refid="menu_column"/>
        from `sys_menu`
        where `is_deleted` = 1
        order by `sort`
    </select>

    <select id="countByParentId" resultType="Long">
        select count(`id`)
        from `sys_menu`
        where `parent_id` = #{menuId} and `is_deleted` = 1
    </select>
</mapper>
